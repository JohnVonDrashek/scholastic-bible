---
interface Props {
  number: number;
  text: string;
  patched?: boolean;
  footnotes?: string[];
  isFirst?: boolean;
}

const { number, text, patched = false, footnotes = [], isFirst = false } = Astro.props;
const hasFootnotes = footnotes.length > 0;

// For drop cap: extract first letter and rest of text
const firstLetter = isFirst ? text.charAt(0) : '';
const restOfText = isFirst ? text.slice(1) : text;
---

<div class:list={["verse", { patched, "verse-first": isFirst }]} id={`v${number}`}>
  {isFirst ? (
    <>
      <span class="drop-cap">{firstLetter}</span>
      <span class="verse-text">{restOfText}</span>
    </>
  ) : (
    <>
      <span class="verse-number">{number}</span>
      <span class="verse-text">{text}</span>
    </>
  )}
  {hasFootnotes && (
    <sup class="footnote-marker" data-verse={number}>*</sup>
  )}
</div>

{hasFootnotes && (
  <div class="footnotes" id={`fn${number}`}>
    {footnotes.map((note, i) => (
      <p class="footnote">
        <span class="footnote-ref">{number}.{i + 1}</span> {note}
      </p>
    ))}
  </div>
)}

<style>
  .verse {
    margin-bottom: 0.25rem;
  }

  .verse.patched {
    background: var(--color-patched);
    padding: 0.25rem 0.5rem;
    margin-left: -0.5rem;
    margin-right: -0.5rem;
    border-radius: 3px;
  }

  .verse-first {
    display: block;
    margin-bottom: 0.5rem;
  }

  .drop-cap {
    float: left;
    font-family: var(--font-drop-cap), serif;
    font-size: 4em;
    line-height: 0.8;
    padding: 0.05em 0.12em 0.05em 0.08em;
    margin-right: 0.1em;
    margin-top: 0.05em;
    background-color: var(--book-color, var(--color-accent));
    color: white;
    font-weight: 700;
    border-radius: 4px;
  }

  .verse-number {
    font-size: 0.75rem;
    color: var(--book-color, var(--color-accent));
    vertical-align: super;
    margin-right: 0.25rem;
  }

  .verse-text {
    /* inherits from body */
  }

  .footnote-marker {
    color: var(--color-accent);
    cursor: pointer;
    margin-left: 0.125rem;
  }

  .footnotes {
    margin: 0.5rem 0 1rem 1.5rem;
    padding-left: 1rem;
    border-left: 2px solid var(--color-border);
    font-size: 0.9rem;
    color: var(--color-muted);
  }

  .footnote {
    margin-bottom: 0.5rem;
  }

  .footnote-ref {
    font-weight: bold;
    color: var(--color-accent);
  }
</style>
